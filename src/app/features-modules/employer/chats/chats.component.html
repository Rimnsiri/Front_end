<div class="chat-page-wrapper">
    <div class="container">
        <div class="content chat-content">
            <!-- sidebar group -->
            <div class="sidebar-group left-sidebar chat_sidebar">

                <!-- Chats sidebar -->
                <div id="chats" class="left-sidebar-wrap sidebar active slimscroll">

                    <div class="slimscroll">

                        <!-- Left Chat Title -->
                        <div class="left-chat-title all-chats d-flex justify-content-between align-items-center">
                            <div class="select-group-chat">
                                <div class="dropdown">
                                    <a href="javascript:void(0);">
                                        All Chats
                                    </a>

                                </div>
                            </div>
                            <div class="add-section">
                                <ul>
                                    <li><a href="javascript:void(0);" (click)="showSearch2()"
                                            class="user-chat-search-btn"><i class="bx bx-search"></i></a></li>
                                    <li>
                                        <div class="chat-action-btns">
                                            <div class="chat-action-col">
                                                <a class="#" href="javascript:void(0);" data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                    <i class="bx bx-dots-vertical-rounded"></i>
                                                </a>
                                                <div class="dropdown-menu dropdown-menu-end">
                                                    <a href="javascript:void(0);" class="dropdown-item "
                                                        data-bs-toggle="modal" data-bs-target="#new-chat"><span><i
                                                                class="bx bx-message-rounded-add"></i></span>New Chat
                                                    </a>
                                                    <a href="javascript:void(0);" class="dropdown-item"
                                                        data-bs-toggle="modal" data-bs-target="#new-group"><span><i
                                                                class="bx bx-user-circle"></i></span>Create Group</a>
                                                    <a href="javascript:void(0);" class="dropdown-item"
                                                        data-bs-toggle="modal" data-bs-target="#invite-other"><span><i
                                                                class="bx bx-user-plus"></i></span>Invite Others</a>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <!-- Chat Search -->
                                <div class="user-chat-search" [ngClass]="search2 ? 'visible-chat' : ''">
                                    <form>
                                        <span class="form-control-feedback"><i class="bx bx-search"></i></span>
                                        <input type="text" name="chat-search" placeholder="Search" class="form-control">
                                        <div class="user-close-btn-chat" (click)="hideSearch2()"(keydown)="onKeyDown($event)"
                                        tabindex="0"><span class="material-icons">close</span></div>
                                    </form>
                                </div>
                                <!-- /Chat Search -->
                            </div>
                        </div>
                        <!-- /Left Chat Title -->
                        <ng-scrollbar visibility="hover">
                            <div class="sidebar-body chat-body" id="chatsidebar">
                              <div class="d-flex justify-content-between align-items-center ps-0 pe-0">
                                <div class="fav-title pin-chat">
                                  <h6><i class="fa-regular fa-comment"></i> Tous les messages</h6>
                                </div>
                              </div>
                              <ul class="user-list space-chat">
                                <li *ngFor="let message of messages; trackBy: trackByMessages" (click)="selectMessage(message)" class="user-list-item chat-user-list">
                                  <a href="javascript:void(0);" class="status-active">
                                    <div class="avatar avatar-online">
                                      <img src="assets\img\user\avatar-1.png" class="rounded-circle" alt="image">
                                    </div>
                                    <div class="users-list-body">
                                      <div>
                                        <h5>{{ message.name }}</h5>
                                        <p>{{ message.response.message }}</p> 
                                      </div>
                                      <div class="last-chat-time">
                                        <small class="text-muted">{{ message.response_time }}</small>
                                      </div>
                                    </div>
                                  </a>
                                </li>
                              </ul>
                            </div>
                          </ng-scrollbar>
                          
                    </div>

                </div>
                <!-- / Chats sidebar -->
            </div>
            <!-- /Sidebar group -->

            <!-- Chat -->
            <div class="chat chat-messages" id="middle">

                <div  class="chat-header" *ngIf="selectedMessage" >
                    <div class="user-details">
                        <div class="d-lg-none">
                            <ul class="list-inline mt-2 me-2">
                                <li class="list-inline-item">
                                    <a class="text-muted px-0 left_sides" href="javascript:void(0);" data-chat="open">
                                        <i class="fas fa-arrow-left"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <figure class="avatar ms-1">
                            <img src="assets\img\user\avatar-1.png" class="rounded-circle" alt="image">
                        </figure>
                        <div class="mt-1">
                            <h5>{{ selectedMessage.name }}</h5>
                            <small class="last-seen">
                              Last Seen at time
                            </small>
                          </div>
                    </div>
                    <div class="chat-options ">
                        <ul class="list-inline">
                            <li class="list-inline-item">
                                <a href="javascript:void(0)" class="btn btn-outline-light chat-search-btn"
                                    data-bs-toggle="tooltip" data-bs-placement="bottom" title="Search"
                                    matTooltip="Search">
                                    <i class="bx bx-search"></i>
                                </a>
                            </li>
                            <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                title="Video Call" matTooltip="Video Call">
                                <a href="javascript:void(0)" class="btn btn-outline-light" data-bs-toggle="modal"
                                    data-bs-target="#video_call">
                                    <i class="bx bx-video"></i>
                                </a>
                            </li>
                            <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                title="Voice Call" matTooltip="Voice Call">
                                <a href="javascript:void(0)" class="btn btn-outline-light" data-bs-toggle="modal"
                                    data-bs-target="#voice_call">
                                    <i class="bx bx-phone"></i>
                                </a>
                            </li>
                            <li class="list-inline-item dream_profile_menu">
                                <a href="javascript:void(0)" class="btn btn-outline-light not-chat-user"
                                    (click)="showUserDetail()" data-bs-toggle="tooltip" data-bs-placement="bottom"
                                    title="Contact Info" matTooltip="Contact Info">
                                    <i class="bx bx-info-circle"></i>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a class="btn btn-outline-light no-bg" href="javascript:void(0);"
                                    data-bs-toggle="dropdown">
                                    <i class="bx bx-dots-vertical-rounded"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a [routerLink]="routes.home" class="dropdown-item "><span><i
                                                class="bx bx-x"></i></span>Close Chat </a>
                                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                                        data-bs-target="#mute-notification"><span><i
                                                class="bx bx-volume-mute"></i></span>Mute Notification</a>
                                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                                        data-bs-target="#disappearing-messages"><span><i
                                                class="bx bx-time-five"></i></span>Disappearing Message</a>
                                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                                        data-bs-target="#clear-chat"><span><i class="bx bx-brush-alt"></i></span>Clear
                                        Message</a>
                                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                                        data-bs-target="#change-chat"><span><i class="bx bx-trash"></i></span>Delete
                                        Chat</a>
                                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                                        data-bs-target="#report-user"><span><i
                                                class="bx bx-dislike"></i></span>Report</a>
                                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                                        data-bs-target="#block-user"><span><i class="bx bx-block"></i></span>Block</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!-- Chat Search -->
                    <div class="chat-search">
                        <form>
                            <span class="form-control-feedback"><i class="bx bx-search"></i></span>
                            <input type="text" name="chat-search" placeholder="Search Chats" class="form-control">
                            <div class="close-btn-chat"><span class="material-icons">close</span></div>
                        </form>
                    </div>
                    <!-- /Chat Search -->
                </div>
                <ng-scrollbar *ngIf="selectedMessage">
                    <div class="chat-body chat-page-group slimscroll">
                      <div class="messages">
                        <div class="chat-line">
                            <span class="chat-date">{{ selectedMessage.response_time | date: 'longDate' }}</span>
                        </div>
                        <!-- Boucle sur chaque message -->
                        <div *ngFor="let message of messages; let i = index">
                         
                            <div *ngFor="let message of messages; let i = index">
                                <div class="chats chats-right" [class.new-session]="message.newSession">
                                  <div class="chat-avatar">
                                    <img src="assets\img\user\avatar-1.png" class="rounded-circle dreams_chat" alt="Entreprise">
                                  </div>
                                  <div class="chat-content">
                                    <div class="chat-profile-name">
                                      <h6>Entreprise<span>{{ message.created_at | date: 'shortTime' }}</span></h6>
                                    </div>
                                    <div class="message-content">
                                      {{ message.message }}
                                    </div>
                                  </div>
                                </div>
                              </div>
                          <div class="chats" *ngIf="message.response" >
                            <div class="chat-avatar">
                              <img src="assets\img\user\avatar-1.png" class="rounded-circle dreams_chat" alt="Développeur">
                            </div>
                            <div class="chat-content">
                              <div class="chat-profile-name">
                                <h6>Développeur<span>{{ message.response_time | date: 'shortTime' }}</span></h6>
                              </div>
                              <div class="message-content reply-getcontent">
                                {{ message.response }}
                              </div>
                            </div>
                          </div>

            
                        </div>
                      </div>
                    </div>
                  </ng-scrollbar>
                  
                  
                  
                 
                  
                  
                  
            </div>
            <!-- /Chat -->

            <!-- Right sidebar -->
            <div  class="right-sidebar right_sidebar_profile right-side-contact show-right-sidebar" id="middle1"
                [ngClass]="userInfo?'show-right-sidebar':'hide-right-sidebar'">
                <div class="right-sidebar-wrap active">
                    <div class="slimscroll">
                        <ng-scrollbar>
                            <div
                                class="left-chat-title d-flex justify-content-between align-items-center border-bottom-0">
                                <div class="fav-title mb-0">
                                    <h6>Contact Info</h6>
                                </div>
                                <div class="contact-close_call text-end">
                                    <a href="javascript:void(0);" class="close_profile close_profile4"
                                        (click)="hideUserDetail()">
                                        <span class="material-icons">close</span>
                                    </a>
                                </div>
                            </div>
                            <div class="sidebar-body">
                                <div class="mt-0 right_sidebar_logo">
                                    <div class="text-center right-sidebar-profile">
                                        <figure class="avatar avatar-xl mb-3">
                                            <img src="assets\img\user\avatar-1.png" class="rounded-circle"
                                                alt="image">
                                        </figure>
                                        <h5 class="profile-name">{{ selectedMessage.name }}</h5>
                                        <div class="last-seen-profile">
                                            <span>last seen at 07:15 PM</span>
                                        </div>
                                        <div class="chat-options chat-option-profile">
                                            <ul class="list-inline">
                                                <li class="list-inline-item" data-bs-toggle="tooltip"
                                                    data-bs-placement="bottom" title="Voice Call"
                                                    matTooltip="Voice Call">
                                                    <a href="javascript:void(0);" class="btn btn-outline-light "
                                                        data-bs-toggle="modal" data-bs-target="#voice_call">
                                                        <i class="bx bx-phone"></i>
                                                    </a>
                                                </li>
                                                <li class="list-inline-item " data-bs-toggle="tooltip"
                                                    matTooltip="Video Call" data-bs-placement="bottom"
                                                    title="Video Call">
                                                    <a href="javascript:void(0);"
                                                        class="btn btn-outline-light profile-open"
                                                        data-bs-toggle="modal" data-bs-target="#voice_call">
                                                        <i class="bx bx-video"></i>
                                                    </a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a [routerLink]="routes.employee_chat" class="btn btn-outline-light"
                                                        data-bs-toggle="tooltip" data-bs-placement="bottom" title="Chat"
                                                        matTooltip="Chat">
                                                        <i class="bx bx-message-square-dots"></i>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="chat-footer" *ngIf="selectedMessage">
                                        <form (submit)="submitResponse(responseInput.value)">
                                          <input type="text" class="form-control chat_form" placeholder="Type your response here..." #responseInput>
                                          <div class="form-buttons">
                                            <button type="submit" class="btn send-btn" style="color: orangered;">
                                              <i class="bx bx-paper-plane"></i>
                                            </button>
                                          </div>
                                        </form>
                                      </div>
                                      

                                </div>
                            </div>
                            
                          
                        </ng-scrollbar>
                    </div>
                </div>
            </div>
            <!-- Right sidebar -->


        </div>
    </div>
</div>
