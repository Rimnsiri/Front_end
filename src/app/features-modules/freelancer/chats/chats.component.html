<div class="chat-page-wrapper">
  <div class="container">
    <div class="content chat-content">
      <!-- sidebar group -->
      <div class="sidebar-group left-sidebar chat_sidebar">
        <!-- Chats sidebar -->
        <div id="chats" class="left-sidebar-wrap sidebar active slimscroll">
          <div class="slimscroll">
            <!-- Left Chat Title -->
            <div
              class="left-chat-title all-chats d-flex justify-content-between align-items-center"
            >
              <div class="select-group-chat">
                <div class="dropdown">
                  <a href="javascript:void(0);"> All Chats </a>
                </div>
              </div>
              <div class="add-section">
                <ul>
                  <li>
                    <a
                      href="javascript:void(0);"
                      (click)="showSearch2()"
                      class="user-chat-search-btn"
                      ><i class="bx bx-search"></i
                    ></a>
                  </li>
                  <li>
                    <div class="chat-action-btns">
                      <div class="chat-action-col">
                        <a
                          class="#"
                          href="javascript:void(0);"
                          data-bs-toggle="dropdown"
                          aria-expanded="false"
                        >
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                          <a
                            href="javascript:void(0);"
                            class="dropdown-item"
                            data-bs-toggle="modal"
                            data-bs-target="#new-chat"
                            ><span
                              ><i class="bx bx-message-rounded-add"></i></span
                            >New Chat
                          </a>
                          <a
                            href="javascript:void(0);"
                            class="dropdown-item"
                            data-bs-toggle="modal"
                            data-bs-target="#new-group"
                            ><span><i class="bx bx-user-circle"></i></span
                            >Create Group</a
                          >
                          <a
                            href="javascript:void(0);"
                            class="dropdown-item"
                            data-bs-toggle="modal"
                            data-bs-target="#invite-other"
                            ><span><i class="bx bx-user-plus"></i></span>Invite
                            Others</a
                          >
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
                <!-- Chat Search -->
                <div
                  class="user-chat-search"
                  [ngClass]="search2 ? 'visible-chat' : ''"
                >
                  <form>
                    <span class="form-control-feedback"
                      ><i class="bx bx-search"></i
                    ></span>
                    <input
                      type="text"
                      name="chat-search"
                      placeholder="Search"
                      class="form-control"
                    />
                    <div
                      class="user-close-btn-chat"
                      (click)="hideSearch2()"
                      (keydown)="onKeyDown($event)"
                      tabindex="0"
                    >
                      <span class="material-icons">close</span>
                    </div>
                  </form>
                </div>
                <!-- /Chat Search -->
              </div>
            </div>
            <!-- /Left Chat Title -->
            <ng-scrollbar visibility="hover">
              <div class="sidebar-body chat-body" id="chatsidebar">
                <!-- Left Chat Title -->
                <div
                  class="d-flex justify-content-between align-items-center ps-0 pe-0"
                >
                  <div class="fav-title pin-chat">
                    <h6>
                      <i class="fa-regular fa-comment"></i> tout les message
                    </h6>
                  </div>
                </div>
                <!-- /Left Chat Title -->

                <ul class="user-list space-chat">
                  <li
                    *ngFor="let message of messages"
                    class="user-list-item chat-user-list"
                    (click)="selectUser(message)"
                  >
                    <a href="javascript:void(0);" class="status-active">
                      <div class="avatar avatar-online">
                        <!-- Vous pouvez choisir de mettre une image statique ou dynamique selon votre modèle -->
                        <img
                          src="assets/img/avatar/icons8-organization-40.png"
                          class="rounded-circle"
                          alt="image"
                        />
                      </div>
                      <div class="users-list-body">
                        <div>
                          <h4>{{ message.name }}</h4>
                        </div>
                        <div class="last-chat-time">
                          <small class="text-muted">{{
                            message.time | date : "shortTime"
                          }}</small>
                          <div class="chat-pin">
                            <i class="bx bx-pin me-2"></i>
                            <i class="bx bx-check-double"></i>
                          </div>
                        </div>
                      </div>
                    </a>
                    <div class="chat-hover ms-1">
                      <div class="chat-action-col">
                        <span class="d-flex" data-bs-toggle="dropdown">
                          <i class="bx bx-dots-vertical-rounded"></i>
                        </span>
                        <div
                          class="dropdown-menu chat-drop-menu dropdown-menu-end"
                        >
                          <span class="dropdown-item"
                            ><i class="bx bx-archive-in"></i> Archive Chat
                          </span>
                          <span
                            class="dropdown-item"
                            data-bs-toggle="modal"
                            data-bs-target="#mute-notification"
                            ><i class="bx bx-volume-mute"></i> Mute
                            Notification</span
                          >
                          <span
                            class="dropdown-item"
                            data-bs-toggle="modal"
                            data-bs-target="#change-chat"
                            ><i class="bx bx-log-out"></i> Delete Chat</span
                          >
                          <span class="dropdown-item"
                            ><i class="bx bx-pin"></i> Unpin Chat</span
                          >
                          <span class="dropdown-item"
                            ><i class="bx bx-check-square"></i> Mark as
                            Unread</span
                          >
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </ng-scrollbar>
          </div>
        </div>
        <!-- / Chats sidebar -->
      </div>
      <!-- /Sidebar group -->

      <!-- Chat -->
      <div class="chat chat-messages" id="middle">
        <div *ngIf="selectedUser" class="chat-header">
          <div class="user-details">
            <div class="d-lg-none">
              <ul class="list-inline mt-2 me-2">
                <li class="list-inline-item">
                  <a
                    class="text-muted px-0 left_sides"
                    href="javascript:void(0);"
                    data-chat="open"
                  >
                    <i class="fas fa-arrow-left"></i>
                  </a>
                </li>
              </ul>
            </div>
            <figure class="avatar ms-1">
              <img
                src="assets/img/avatar/icons8-organization-40.png"
                class="rounded-circle"
                alt="image"
              />
            </figure>
            <div class="mt-1">
              <h5>{{ selectedUser.name }}</h5>
              <small class="last-seen">
                Last Seen at {{ selectedUser.lastSeenTime }}
              </small>
            </div>
          </div>
          <div class="chat-options">
            <ul class="list-inline">
              <li class="list-inline-item">
                <a
                  href="javascript:void(0)"
                  class="btn btn-outline-light chat-search-btn"
                  data-bs-toggle="tooltip"
                  data-bs-placement="bottom"
                  title="Search"
                  matTooltip="Search"
                >
                  <i class="bx bx-search"></i>
                </a>
              </li>
              <li
                class="list-inline-item"
                data-bs-toggle="tooltip"
                data-bs-placement="bottom"
                title="Video Call"
                matTooltip="Video Call"
              >
                <a
                  href="javascript:void(0)"
                  class="btn btn-outline-light"
                  data-bs-toggle="modal"
                  data-bs-target="#video_call"
                >
                  <i class="bx bx-video"></i>
                </a>
              </li>
              <li
                class="list-inline-item"
                data-bs-toggle="tooltip"
                data-bs-placement="bottom"
                title="Voice Call"
                matTooltip="Voice Call"
              >
                <a
                  href="javascript:void(0)"
                  class="btn btn-outline-light"
                  data-bs-toggle="modal"
                  data-bs-target="#voice_call"
                >
                  <i class="bx bx-phone"></i>
                </a>
              </li>
              <li class="list-inline-item dream_profile_menu">
                <a
                  href="javascript:void(0)"
                  class="btn btn-outline-light not-chat-user"
                  (click)="showUserDetail()"
                  data-bs-toggle="tooltip"
                  data-bs-placement="bottom"
                  title="Contact Info"
                  matTooltip="Contact Info"
                >
                  <i class="bx bx-info-circle"></i>
                </a>
              </li>
              <li class="list-inline-item">
                <a
                  class="btn btn-outline-light no-bg"
                  href="javascript:void(0);"
                  data-bs-toggle="dropdown"
                >
                  <i class="bx bx-dots-vertical-rounded"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-end">
                  <a [routerLink]="routes.home" class="dropdown-item"
                    ><span><i class="bx bx-x"></i></span>Close Chat
                  </a>
                  <a
                    href="javascript:void(0);"
                    class="dropdown-item"
                    data-bs-toggle="modal"
                    data-bs-target="#mute-notification"
                    ><span><i class="bx bx-volume-mute"></i></span>Mute
                    Notification</a
                  >
                  <a
                    href="javascript:void(0);"
                    class="dropdown-item"
                    data-bs-toggle="modal"
                    data-bs-target="#disappearing-messages"
                    ><span><i class="bx bx-time-five"></i></span>Disappearing
                    Message</a
                  >
                  <a
                    href="javascript:void(0);"
                    class="dropdown-item"
                    data-bs-toggle="modal"
                    data-bs-target="#clear-chat"
                    ><span><i class="bx bx-brush-alt"></i></span>Clear
                    Message</a
                  >
                  <a
                    href="javascript:void(0);"
                    class="dropdown-item"
                    data-bs-toggle="modal"
                    data-bs-target="#change-chat"
                    ><span><i class="bx bx-trash"></i></span>Delete Chat</a
                  >
                  <a
                    href="javascript:void(0);"
                    class="dropdown-item"
                    data-bs-toggle="modal"
                    data-bs-target="#report-user"
                    ><span><i class="bx bx-dislike"></i></span>Report</a
                  >
                  <a
                    href="javascript:void(0);"
                    class="dropdown-item"
                    data-bs-toggle="modal"
                    data-bs-target="#block-user"
                    ><span><i class="bx bx-block"></i></span>Block</a
                  >
                </div>
              </li>
            </ul>
          </div>
          <!-- Chat Search -->
          <div class="chat-search">
            <form>
              <span class="form-control-feedback"
                ><i class="bx bx-search"></i
              ></span>
              <input
                type="text"
                name="chat-search"
                placeholder="Search Chats"
                class="form-control"
              />
              <div class="close-btn-chat">
                <span class="material-icons">close</span>
              </div>
            </form>
          </div>
          <!-- /Chat Search -->
        </div>
        <ng-scrollbar>
          <div
            class="chat-body chat-page-group slimscroll"
            *ngIf="selectedUser"
          >
            <div class="messages">
              <!-- Afficher chaque message et réponse de l'utilisateur -->
              <div
                *ngFor="let message of selectedUserMessages; let i = index"
                class="chats"
              >
                <div class="chat-avatar">
                  <img src="assets/img/avatar/icons8-organization-40.png"
                    class="rounded-circle dreams_chat"
                    alt="image"
                  />
                </div>
                <div class="chat-content">
                  <div class="chat-profile-name">
                    <h6>
                      {{ selectedUser.name}}<span>{{ formatTime(message.timestamp) }}</span>
                    </h6>
                  </div>
                  <div class="message-content reply-getcontent">
                    {{ message }}
                  </div>
                </div>
              </div>
              <!-- Afficher chaque réponse -->
              <div *ngFor="let response of selectedUser.responseArray; let i = index" class="chats chats-right">
                <div class="chat-avatar">
                  <img  [src]="profileData.photo" class="rounded-circle dreams_chat" alt="image" />
                </div>
                <div class="chat-content">
                  <div class="chat-profile-name">
                    <h6>Moi<span>{{ formatTime(response.response_time) }}</span></h6>
                  </div>
                  <div class="message-content reply-getcontent">
                    {{ response }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-scrollbar>

        <div class="chat-footer">
          <form (ngSubmit)="sendResponse(responseInput.value)">
            <input
              type="text"
              class="form-control chat_form"
              placeholder="Type your response here..."
              #responseInput
            />
            <div class="form-buttons">
              <button type="submit" class="btn send-btn">
                <i class="bx bx-paper-plane"></i>
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- /Chat -->

      <!-- Right sidebar -->
      <div
        *ngIf="selectedUser"
        class="right-sidebar right_sidebar_profile right-side-contact show-right-sidebar"
        id="middle1"
        [ngClass]="userInfo ? 'show-right-sidebar' : 'hide-right-sidebar'"
      >
        <div class="right-sidebar-wrap active">
          <div class="slimscroll">
            <ng-scrollbar>
              <div
                class="left-chat-title d-flex justify-content-between align-items-center border-bottom-0"
              >
                <div class="fav-title mb-0">
                  <h6>Contact Info</h6>
                </div>
                <div class="contact-close_call text-end">
                  <a
                    href="javascript:void(0);"
                    class="close_profile close_profile4"
                    (click)="hideUserDetail()"
                  >
                    <span class="material-icons">close</span>
                  </a>
                </div>
              </div>
              <div class="sidebar-body">
                <div class="mt-0 right_sidebar_logo">
                  <div class="text-center right-sidebar-profile">
                    <figure class="avatar avatar-xl mb-3">
                      <img
                        src="assets/img/avatar/icons8-organization-40.png"
                        class="rounded-circle"
                        alt="image"
                      />
                    </figure>
                    <h5 class="profile-name">{{ selectedUser.name }}</h5>
                    <div class="last-seen-profile">
                      <span>last seen at 07:15 PM</span>
                    </div>
                    <div class="chat-options chat-option-profile">
                      <ul class="list-inline">
                        <li
                          class="list-inline-item"
                          data-bs-toggle="tooltip"
                          data-bs-placement="bottom"
                          title="Voice Call"
                          matTooltip="Voice Call"
                        >
                          <a
                            href="javascript:void(0);"
                            class="btn btn-outline-light"
                            data-bs-toggle="modal"
                            data-bs-target="#voice_call"
                          >
                            <i class="bx bx-phone"></i>
                          </a>
                        </li>
                        <li
                          class="list-inline-item"
                          data-bs-toggle="tooltip"
                          matTooltip="Video Call"
                          data-bs-placement="bottom"
                          title="Video Call"
                        >
                          <a
                            href="javascript:void(0);"
                            class="btn btn-outline-light profile-open"
                            data-bs-toggle="modal"
                            data-bs-target="#voice_call"
                          >
                            <i class="bx bx-video"></i>
                          </a>
                        </li>
                        <li class="list-inline-item">
                          <a
                            [routerLink]="routes.employee_chat"
                            class="btn btn-outline-light"
                            data-bs-toggle="tooltip"
                            data-bs-placement="bottom"
                            title="Chat"
                            matTooltip="Chat"
                          >
                            <i class="bx bx-message-square-dots"></i>
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="chat-member-details">
                    <div class="member-details">
                      <ul>
                        <li>
                          <h5>Info</h5>
                        </li>
                        <li>
                          <h6>Bio</h6>
                          <span>Hello, I am using DreamsChat</span>
                        </li>
                        <li>
                          <h6>Phone</h6>
                          <span>{{ selectedUser.phone }}</span>
                        </li>
                        <li>
                          <h6>Email Address</h6>
                          <span>{{ selectedUser.email }}</span>
                        </li>
                        <li>
                          <h6>Social Media</h6>
                          <div class="social-icons">
                            <a href="https://www.facebook.com/" target="_blank"
                              ><i class="bx bxl-facebook"></i
                            ></a>
                            <a href="https://twitter.com/" target="_blank"
                              ><i class="bx bxl-twitter"></i
                            ></a>
                            <a href="javascript:void(0);" target="_blank"
                              ><i class="bx bxl-youtube"></i
                            ></a>
                            <a href="https://in.linkedin.com/" target="_blank"
                              ><i class="bx bxl-linkedin"></i
                            ></a>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </ng-scrollbar>
          </div>
        </div>
      </div>
      <!-- Right sidebar -->
    </div>
  </div>
</div>

<!-- Voice Call Modal -->
<div class="modal fade call-modal" id="voice_call">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <!-- Outgoing Call -->
        <div class="call-box incoming-box">
          <div class="call-wrapper">
            <div class="call-inner">
              <div class="call-user">
                <img
                  alt="User Image"
                  src="assets/img/img-05.jpg"
                  class="call-avatar"
                />
                <h4>Darren Elder</h4>
                <span>Connecting...</span>
              </div>
              <div class="call-items">
                <a
                  href="javascript:void(0);"
                  class="btn call-item call-end"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                  ><i class="material-icons">call_end</i></a
                >
                <a href="javascript:void(0);" class="btn call-item call-start"
                  ><i class="material-icons">call</i></a
                >
              </div>
            </div>
          </div>
        </div>
        <!-- Outgoing Call -->
      </div>
    </div>
  </div>
</div>
<!-- /Voice Call Modal -->

<!-- Video Call Modal -->
<div class="modal fade call-modal" id="video_call">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <!-- Incoming Call -->
        <div class="call-box incoming-box">
          <div class="call-wrapper">
            <div class="call-inner">
              <div class="call-user">
                <img
                  class="call-avatar"
                  src="assets/img/img-05.jpg"
                  alt="User Image"
                />
                <h4>Darren Elder</h4>
                <span>Calling ...</span>
              </div>
              <div class="call-items">
                <a
                  href="javascript:void(0);"
                  class="btn call-item call-end"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                  ><i class="material-icons">call_end</i></a
                >
                <a href="javascript:void(0);" class="btn call-item call-start"
                  ><i class="material-icons">videocam</i></a
                >
              </div>
            </div>
          </div>
        </div>
        <!-- /Incoming Call -->
      </div>
    </div>
  </div>
</div>
<!-- Video Call Modal -->
